---
title: "Análise Exploratória de Dados da Educação Superior em R"
output: html_notebook
---

---

# Introdução

Neste notebook do R iremos analisar microdados educaionais extraidos do [Senso Educacional 2024] (https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/microdados/censo-da-educacao-superior)


## Lendo os dados
Os comandos abaixo fará a leitura dos seguintes dados:

* dicionáario de dados onde contem ...
+ Cadastro de cursos superiores
+ Cadastro das instituções de educação, abragendo Universidades e Institutos Federais
+

```{r}
library(readxl)
# DICIONAÁRIO DE DADOS
disc_dados <- read_excel("/users/waldex/Documents/Github/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/dicionário_dados_educação_superior.xlsx")
#caminho_correto <- file.choose()
#print(caminho_correto)
```

```{r}
#CURSOS
cadastro_cursos<-read.csv("/Users/waldex/Documents/GitHub/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/MICRODADOS_CADASTRO_CURSOS_2024.CSV", sep=';', encoding='latin1')

```

```{r}
#CURSOS
microdados_ies<-read.csv("/Users/waldex/Documents/GitHub/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/MICRODADOS_ED_SUP_IES_2024.CSV", sep=";", encoding = "latin1", header = TRUE)
```


```{r}

POP_UF <- read_excel("/users/waldex/Documents/Github/Projeto_Ferramentas_Computacionais/dados_populacionais/POP_UF.xls")

head(POP_UF)
```

##Formando uma base de dados com as Instituções de Ensino Superior para filtrar informações de interesse
```{r}
library(dplyr)

dados_ies <- data.frame(
  "REGIAO" = microdados_ies$NO_REGIAO_IES,
  "ESTADO" = microdados_ies$NO_UF_IES,
  "UF" = microdados_ies$SG_UF_IES,
  "MUNICIPIO" = microdados_ies$NO_MUNICIPIO_IES,
  
  # Mapeamento: IN_CAPITAL_IES (usando ifelse)
  "CAPITAL" = ifelse(microdados_ies$IN_CAPITAL_IES == 1, "Sim", "Não"),
  
  # Mapeamento: TP_REDE (usando ifelse)
  "REDE" = ifelse(microdados_ies$TP_REDE == 1, "Pública", "Privada"),
  
  # Mapeamento: TP_ORGANIZACAO_ACADEMICA (usando case_when para mapeamento de múltiplos valores)
  "NOME_CURSO" = case_when(
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 1 ~ "Universidade",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 2 ~ "Centro Universitário",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 3 ~ "Faculdade",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 4 ~ "Instituto Federal",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 5 ~ "Centro Federal de Ed. Tecnológica",
    TRUE ~ NA_character_ # Para qualquer outro valor, atribui NA (ou outro valor padrão)
  ),
  
  # Mapeamento: TP_CATEGORIA_ADMINISTRATIVA (Equivalente à função lambda)
  "ORG. ADM" = case_when(
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA >= 4 ~ "Privada",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 1 ~ "Federal",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 2 ~ "Estadual",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 3 ~ "Municipal",
    TRUE ~ NA_character_ # Caso contrário (ou valor não mapeado)
  ),
  
  "NOME_IES" = microdados_ies$NO_IES,
  "CO_IES" = microdados_ies$CO_IES,
  "SIGLA_IES" = microdados_ies$SG_IES,
  
  # Colunas Quantitativas Simples
  "QT_TEC_TOTAL" = microdados_ies$QT_TEC_TOTAL,
  "QT_TEC_FUND_INCOMP_FEM" = microdados_ies$QT_TEC_FUNDAMENTAL_INCOMP_FEM,
  "QT_TEC_FUND_INCOMP_MASC" = microdados_ies$QT_TEC_FUNDAMENTAL_INCOMP_MASC,
  "QT_TEC_FUND_COMP_FEM" = microdados_ies$QT_TEC_FUNDAMENTAL_COMP_FEM,
  "QT_TEC_FUND_COMP_MASC" = microdados_ies$QT_TEC_FUNDAMENTAL_COMP_MASC,
  "QT_TEC_MEDIO_FEM" = microdados_ies$QT_TEC_MEDIO_FEM,
  "QT_TEC_MEDIO_MASC" = microdados_ies$QT_TEC_MEDIO_MASC,
  "QT_TEC_SUPERIOR_FEM" = microdados_ies$QT_TEC_SUPERIOR_FEM,
  "QT_TEC_SUPERIOR_MASC" = microdados_ies$QT_TEC_SUPERIOR_MASC,
  "QT_TEC_ESPECIALIZACAO_FEM" = microdados_ies$QT_TEC_ESPECIALIZACAO_FEM,
  "QT_TEC_ESPECIALIZACAO_MASC" = microdados_ies$QT_TEC_ESPECIALIZACAO_MASC,
  "QT_TEC_MESTRADO_FEM" = microdados_ies$QT_TEC_MESTRADO_FEM,
  "QT_TEC_MESTRADO_MASC" = microdados_ies$QT_TEC_MESTRADO_MASC,
  "QT_TEC_DOUTORADO_FEM" = microdados_ies$QT_TEC_DOUTORADO_FEM,
  "QT_TEC_DOUTORADO_MASC" = microdados_ies$QT_TEC_DOUTORADO_MASC,
  "QT_DOC_TOTAL" = microdados_ies$QT_DOC_TOTAL,
  "QT_DOC_EXE" = microdados_ies$QT_DOC_EXE,
  "QT_DOC_EX_FEM" = microdados_ies$QT_DOC_EX_FEMI, # Notei QT_DOC_EX_FEMI no seu código Python
  "QT_DOC_EX_MASC" = microdados_ies$QT_DOC_EX_MASC,
  "QT_DOC_EX_SEM_GRAD" = microdados_ies$QT_DOC_EX_SEM_GRAD,
  "QT_DOC_EX_GRAD" = microdados_ies$QT_DOC_EX_GRAD,
  "QT_DOC_EX_ESPEC" = microdados_ies$QT_DOC_EX_ESP, # Notei QT_DOC_EX_ESP no seu código Python
  "QT_DOC_EX_MESTRE" = microdados_ies$QT_DOC_EX_MEST,
  "QT_DOC_EX_DOUTOR" = microdados_ies$QT_DOC_EX_DOUT,
  "QT_DOC_EX_0_29" = microdados_ies$QT_DOC_EX_0_29,
  "QT_DOC_EX_30_34" = microdados_ies$QT_DOC_EX_30_34,
  "QT_DOC_EX_35_39" = microdados_ies$QT_DOC_EX_35_39,
  "QT_DOC_EX_40_44" = microdados_ies$QT_DOC_EX_40_44,
  "QT_DOC_EX_45_49" = microdados_ies$QT_DOC_EX_45_49,
  "QT_DOC_EX_50_54" = microdados_ies$QT_DOC_EX_50_54,
  "QT_DOC_EX_55_59" = microdados_ies$QT_DOC_EX_55_59,
  "QT_DOC_EX_60_MAIS" = microdados_ies$QT_DOC_EX_60_MAIS,
  "QT_DOC_EX_BRANCA" = microdados_ies$QT_DOC_EX_BRANCA,
  "QT_DOC_EX_PRETA" = microdados_ies$QT_DOC_EX_PRETA,
  "QT_DOC_EX_PARDA" = microdados_ies$QT_DOC_EX_PARDA,
  "QT_DOC_EX_AMARELA" = microdados_ies$QT_DOC_EX_AMARELA,
  "QT_DOC_EX_INDIGENA" = microdados_ies$QT_DOC_EX_INDIGENA,
  "QT_DOC_EX_COR_ND" = microdados_ies$QT_DOC_EX_COR_ND
)
```

```{r paged.print=TRUE}
#dim(microdados_ies)
#dim(dados_ies)
head(dados_ies)
```
##Formando uma base de dados com informações dos cursos para filtrar informações de interesse
```{r}
library(dplyr)
dados_cursos <- cadastro_cursos %>%
  transmute(
    # Mapeamentos simples usando case_when (melhor que if/else aninhado)
    REDE = case_when(
      TP_REDE == 1 ~ "Pública",
      TP_REDE == 2 ~ "Privada",
      TRUE ~ NA_character_ # Default para valores ausentes/não mapeados
    ),
    
    # Mapeamento para NOME_CURSO INST.
    `NOME_CURSO INST.` = case_when(
      TP_ORGANIZACAO_ACADEMICA == 1 ~ "Universidade",
      TP_ORGANIZACAO_ACADEMICA == 2 ~ "Centro Universitário",
      TP_ORGANIZACAO_ACADEMICA == 3 ~ "Faculdade",
      TP_ORGANIZACAO_ACADEMICA == 4 ~ "Instituto Federal",
      TP_ORGANIZACAO_ACADEMICA == 5 ~ "Centro Federal de Ed. Tecnológica",
      TRUE ~ NA_character_
    ),
    
    # Lógica condicional complexa para ORG. ADM
    `ORG. ADM` = case_when(
      TP_CATEGORIA_ADMINISTRATIVA >= 4 ~ "Privada",
      TP_CATEGORIA_ADMINISTRATIVA == 1 ~ "Federal",
      TP_CATEGORIA_ADMINISTRATIVA == 2 ~ "Estadual",
      TP_CATEGORIA_ADMINISTRATIVA == 3 ~ "Municipal",
      TRUE ~ NA_character_
    ),
    
    # Mapeamento para TIPO
    TIPO = case_when(
      TP_GRAU_ACADEMICO == 1 ~ "Bacharelado",
      TP_GRAU_ACADEMICO == 2 ~ "Licenciatura",
      TP_GRAU_ACADEMICO == 3 ~ "Tecnólogo",
      TP_GRAU_ACADEMICO == 4 ~ "Bacharelado e Licenciatura",
      # A lógica original do Python mapeia qualquer outro valor para "Não se aplica"
      TRUE ~ "Não se aplica" 
    ),
    
    # Mapeamento para GRAT
    GRAT = case_when(
      IN_GRATUITO == 0 ~ "Particular",
      IN_GRATUITO == 1 ~ "Gratuíto",
      TRUE ~ NA_character_
    ),
    
    # Mapeamento para MODALIDADE
    MODALIDADE = case_when(
      TP_MODALIDADE_ENSINO == 1 ~ "Presencial",
      TP_MODALIDADE_ENSINO == 2 ~ "à distância",
      TRUE ~ NA_character_
    ),
    
    # Colunas que são apenas cópias diretas
    CO_IES = CO_IES,
    CO_CURSO = CO_CURSO,
    NOME_CURSO = NO_CURSO,
    QT_VAGAS = QT_VG_TOTAL,
    QT_INSC = QT_INSCRITO_TOTAL,
    QT_ING = QT_ING,
    QT_ING_FEM = QT_ING_FEM,
    QT_ING_MASC = QT_ING_MASC,
    QT_ING_ENEM = QT_ING_ENEM,
    `QT_ING_0-17` = `QT_ING_0_17`, # Aspas simples são necessárias no Python; no R, use backticks se o nome não for válido
    `QT_ING_18-24` = `QT_ING_18_24`,
    `QT_ING_25-29` = `QT_ING_25_29`,
    `QT_ING_30-34` = `QT_ING_30_34`,
    `QT_ING_35-39` = `QT_ING_35_39`,
    `QT_ING_40-49` = `QT_ING_40_49`,
    `QT_ING_50-59` = `QT_ING_50_59`,
    `QT_ING_60+` = `QT_ING_60_MAIS`,
    QT_ING_BRANCA = QT_ING_BRANCA,
    QT_ING_PRETA = QT_ING_PRETA,
    QT_ING_PARDA = QT_ING_PARDA,
    QT_ING_AMARELA = QT_ING_AMARELA,
    QT_ING_INDIGENA = QT_ING_INDIGENA,
    QT_ING_COR_ND = QT_ING_CORND,
    QT_MAT = QT_MAT,
    QT_MAT_FEM = QT_MAT_FEM,
    QT_MAT_MASC = QT_MAT_MASC,
    QT_CONC = QT_CONC,
    QT_CONC_FEM = QT_CONC_FEM,
    QT_CONC_MASC = QT_CONC_MASC
  )
```

```{r}
head(dados_cursos)
```

#Analisando o Panoram Geral das Instituições de ensino Supeior
```{r}
tabela_frequencia <- dados_ies %>%
  # 1. Agrupando os dados pela coluna 'REGIAO'
  group_by(REGIAO) %>%
  # 2. Contando o número de ocorrências de cada região (valores absolutos)
  summarise(
    Valores_absolutos = n(),
    .groups = 'drop' # Remove o agrupamento após a sumarização
  ) %>%
  # 3. Calculando o total de instituições (para normalizar)
  mutate(
    Total_Geral = sum(Valores_absolutos),
    # 4. Calculando o percentual e arredondando para 2 casas decimais
    `Percentual (%)` = round((Valores_absolutos / Total_Geral) * 100, 2)
  ) %>%
  # 5. Removendo a coluna auxiliar 'Total_Geral'
  select(-Total_Geral)
```


```{r}
# Exibindo o total de instituições 
total <- sum(tabela_frequencia$Valores_absolutos)
cat(paste("Total de instituições:", total, "\n\n"))
```
Temos um total de 2561 Instituições de Ensino Superior (IES) no Brasil, segundo os dados disponibilizados. Destas a grande maioria, cerca de 42, 01% estão localizadas na região Sudeste. a região Norte é o que tem menos insitutições superiores, apenas 7,65%. Observe que se somarmos o quantitativo das regiões Norte, Sul e Centro-Oeste não atingimos o total de instituições da região sudeste.  O que mostra a grande discrepância do número de instituições de nível superior nas regiões do Brasil, conforme evidencia o gráfico seguinte.


```{r}
library(knitr)
# Exibindo a tabela  com os valores absoltuos e percentuais
kable(
  tabela_frequencia,
  caption = "Tabela 1: Valores absolutos e percentuais de IES por região",
  format = "pipe" # ou "html", "latex", dependendo do seu output
)
```

```{r}
library(ggplot2)

# Definindo o vetor de cores (similar à paleta do Python)
cores <- c('red', 'blue', 'green', 'purple', 'orange')

# Criando o gráfico de barras de contagem
ggplot(dados_ies, aes(x = REGIAO)) + # Define os dados e a variável X
  geom_bar(fill = cores) + # Cria o gráfico de barras e aplica as cores
  labs(
    title = 'Figura 1: Quantitativo de IES por Região',
    x = 'Região',
    y = 'Quantidade de Instituições'
  ) +
  theme_minimal()
```

Sudeste e Nordeste são as duas regiões do Brasil mais populosas de acordo com IBGE (IBGE, 2022), o que nos faz pensar, obviamente, que por conta disso tem maior quantidade de IES, tendo em vista a maior demanda populacional. Isso nos leva a indagar se em termos percentuais há uma discrepância ou similaridade na quantidade de instituições superiores em nosso território, conforme as necessidades de cada região em número de habitantes. Para responder a tal indagação iremos ver a relação entre quantidade de IES e a população.

Utilizamos a projeção do senso feita em 2022 para o ano de 2023 para alinhar com os dados das IES. Fizemos a razão quantidade de instituições pelo número de habitantes de cada região e, como o valor é muito pequeno, colocamos na relação para cada 100 mil habitantes, conforme exibe a Tabela 2.

### Quantidade de instituições x populacão
```{r}
#Realizar a junção (merge) e manipulação
library(dplyr) 
pop_ies <- tabela_frequencia %>%
  left_join(POP_UF, by = "REGIAO") %>%
  select(-CO_REGIAO_IES) %>%
  rename(
    `Val._abs._IES` = Valores_absolutos, 
    `Percentual_ies (%)` = `Percentual (%)`
  )
```
```{r}
#Cálculo de densidade por região
pop_ies <- tabela_frequencia %>%
  left_join(POP_UF, by = "REGIAO") %>%
  select(-CO_REGIAO_IES) %>%
  rename(
    `Val._abs._IES` = Valores_absolutos, 
    `Percentual_ies (%)` = `Percentual (%)`
  ) %>%
  mutate(
    # Calcula IES por 100.000 habitantes
    IES_por_100k = round((`Val._abs._IES` / POPULAÇÃO) * 100000, 2)
  )

pop_ies
```
```{r}
library(knitr)
kable(
  pop_ies,
  caption = "Tabela 2: Quantidade de  IES por 100k habitantes",
  format = "pipe" 
)
```

Observamos que a região Centro-Oeste, apesar de ser a segunda menor em número de IES, em termos proporcionais a população, é a que apresentar maior número proporcional de IES. O que vai de encontro aos valores absolutos. A região Sudeste que tem o maior percentual de IES,em termos proporcionais tem menos IES do que a própria região Sul. Neste sentido, a distribuição de IES no território nacional não privelegia Regiões mais populosas, conseguindo equilibrar a demandanda regional.

### IES por Unidades Federativas (UFs)

dda
```{r}
library(dplyr)

tabela_est <- dados_ies %>%
  # Agrupa os dados pela coluna 'UF'
  group_by(UF) %>%
  # Conta as ocorrências (Valores absolutos)
  summarise(
    `Val._absolutos` = n(),
    .groups = 'drop' # Remove o agrupamento
  ) %>%
  # Calcula o total geral para normalização
  mutate(
    Total_Geral = sum(`Val._absolutos`),
    # Calcula o percentual e arredonda para 2 casas decimais
    Percentual = round((`Val._absolutos` / Total_Geral) * 100, 2)
  ) %>%
  # Remove a coluna auxiliar e seleciona a ordem final
  select(-Total_Geral)

# Exibe a tabela
tabela_est
```
dd
```{r}
library(dplyr)

# Ordena a tabela pela coluna 'Val._absolutos' de forma crescente
tabela_est_ord <- tabela_est %>%
  arrange(`Val._absolutos`)

tabela_est_ord
```

Quando analisamos o quantitativo de instituições por estado, temos um panorama não muito diferente (Figura 2). No entanto, com exceção de São Paulo e Minas Gerais, que são os estados mais populosos do Brasil (IBGE, 2022) e que possui o maior número de IES, o estado do Rio de Janeiro, por exemplo, que é o terceiro mais populoso, tem menos IES do que Paraná e Bahia. Na outra ponta, os estados menos populosos também segue com o menor número de IES, como Roraima, Amapá e Acre. 

```{r}
# Certifique-se de que os pacotes necessários estão carregados
library(ggplot2)
library(dplyr)
library(forcats) # Pacote para manipular fatores, essencial para ordenar o eixo



ggplot(tabela_est, aes(x = fct_reorder(UF, `Val._absolutos`), y = `Val._absolutos`)) +
  geom_bar(stat = "identity", aes(fill = UF)) + # O ggplot2 gera 27 cores
  labs(
    title = 'Figra 2: Distribuição de Instituições por UF',
    x = 'UF',
    y = 'Quantidade de Instituições (Valores Absolutos)'
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```

Para deixar mais ilustrativo a diferença grande do número de IES entre os estados, plotamos o “gráfico de Pareto” da Figura 3. O gráfico mostra a distribuição de instituições por UF, com os valores absolutos em ordem decrescente. A barra azul representa a quantidade de instituições em cada UF. A linha vermelha acompanha os valores absolutos, mostrando a tendência da distribuição.
```{r}
library(dplyr)
library(ggplot2)
library(forcats) # Necessário para fct_reorder

# 1. Ordenar o data frame por 'Val._absolutos' de forma decrescente
tabela_est_ord <- tabela_est %>%
  arrange(desc(`Val._absolutos`))

# 2. Criar o gráfico
ggplot(tabela_est_ord, aes(x = fct_reorder(UF, `Val._absolutos`, .desc = TRUE))) +
  
  # Gráfico de barras (Valores Absolutos)
  geom_bar(aes(y = `Val._absolutos`), stat = "identity", fill = 'blue') +
  
  # Gráfico de linha (Valores Absolutos)
  geom_line(aes(y = `Val._absolutos`, group = 1), color = 'red', linewidth = 1) +
  geom_point(aes(y = `Val._absolutos`), color = 'red', size = 3) +
  
  labs(
    title = 'Figura 3: Distribuição de Instituições por UF((Gráfico de Pareto)',
    x = 'UF',
    y = 'Quantidade de Instituições (Valores Absolutos)'
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1) # Rotação do eixo X
  )
```
Os primeiros UFs têm uma grande quantidade de instituições, indicando uma concentração de instituições nesses estados. Observe um declínio mais acentuado entre os três primeiros estados. Dai o declínio é mais gradual. Neste sentido, o gráfico de Pareto evidencia uma concentração das IES em poucos estados, como São Paulo e Minas Gerais. Os estados com maior número de IES estão no topo, enquanto os estados menos populosos, como Roraima e Amapá, possuem menor quantidade.

## Instituições Públicas x Instituições Privadas
