---
title: "Análise Exploratória de Dados da Educação Superior em R"
output: html_notebook
---

---

# 1. Introdução

Neste notebook do R iremos analisar microdados educaionais extraidos do [Senso Educacional 2024] (https://www.gov.br/inep/pt-br/acesso-a-informacao/dados-abertos/microdados/censo-da-educacao-superior)

## 1.1. Objetivo Geral

Compreender o panorama das Instituições de Ensino Superior (IES) no Brasil, analisando a distribuição regional, diferenças entre instituições públicas e privadas, e o perfil demográfico de funcionários e docentes, com vistas a fornecer dados que podem ajudar no planejamento educacional e políticas públicas.

## 1.2. Objetivos específicos

Analisar a distribuição geográfica das IES no Brasil:

+ Comparar as proporções de instituições públicas e privadas e suas variações regionais.
+ Avaliar as taxas de matrícula e conclusão de cursos, especialmente em instituições públicas.
+ Verificar cursos e tipos mais procurados e outros tipos menos procurados.
+ Examinar o perfil demográfico e de qualificação dos funcionários e docentes das IES.
+ Analisar o perfil étnico racional de alunos e docentes das IES.


# 2. Lendo os dados
Os comandos abaixo fará a leitura dos seguintes dados:

* dicionáario de dados onde contem ...
+ Cadastro de cursos superiores
+ Cadastro das instituções de educação, abragendo Universidades e Institutos Federais
+

```{r,echo=FALSE}
library(readxl)
# DICIONAÁRIO DE DADOS
disc_dados <- read_excel("/users/waldex/Documents/Github/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/dicionário_dados_educação_superior.xlsx")
#caminho_correto <- file.choose()
#print(caminho_correto)
```

```{r}
#CURSOS
cadastro_cursos<-read.csv("/Users/waldex/Documents/GitHub/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/MICRODADOS_CADASTRO_CURSOS_2024.CSV", sep=';', encoding='latin1')

```

```{r}
#CURSOS
microdados_ies<-read.csv("/Users/waldex/Documents/GitHub/Projeto_Ferramentas_Computacionais/microdados_censo_da_educacao_superior_2024/MICRODADOS_ED_SUP_IES_2024.CSV", sep=";", encoding = "latin1", header = TRUE)
```


```{r}

POP_UF <- read_excel("/users/waldex/Documents/Github/Projeto_Ferramentas_Computacionais/dados_populacionais/POP_UF.xls")

head(POP_UF)
```

## 2.1. Formando uma base de dados com as Instituções de Ensino Superior para filtrar informações de interesse
```{r, echo=FALSE}
library(dplyr)

dados_ies <- data.frame(
  "REGIAO" = microdados_ies$NO_REGIAO_IES,
  "ESTADO" = microdados_ies$NO_UF_IES,
  "UF" = microdados_ies$SG_UF_IES,
  "MUNICIPIO" = microdados_ies$NO_MUNICIPIO_IES,
  
  # Mapeamento: IN_CAPITAL_IES (usando ifelse)
  "CAPITAL" = ifelse(microdados_ies$IN_CAPITAL_IES == 1, "Sim", "Não"),
  
  # Mapeamento: TP_REDE (usando ifelse)
  "REDE" = ifelse(microdados_ies$TP_REDE == 1, "Pública", "Privada"),
  
  # Mapeamento: TP_ORGANIZACAO_ACADEMICA (usando case_when para mapeamento de múltiplos valores)
  "NOME_CURSO" = case_when(
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 1 ~ "Universidade",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 2 ~ "Centro Universitário",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 3 ~ "Faculdade",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 4 ~ "Instituto Federal",
    microdados_ies$TP_ORGANIZACAO_ACADEMICA == 5 ~ "Centro Federal de Ed. Tecnológica",
    TRUE ~ NA_character_ # Para qualquer outro valor, atribui NA (ou outro valor padrão)
  ),
  
  # Mapeamento: TP_CATEGORIA_ADMINISTRATIVA
  "ORG. ADM" = case_when(
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA >= 4 ~ "Privada",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 1 ~ "Federal",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 2 ~ "Estadual",
    microdados_ies$TP_CATEGORIA_ADMINISTRATIVA == 3 ~ "Municipal",
    TRUE ~ NA_character_ # Caso contrário (ou valor não mapeado)
  ),
  
  "NOME_IES" = microdados_ies$NO_IES,
  "CO_IES" = microdados_ies$CO_IES,
  "SIGLA_IES" = microdados_ies$SG_IES,
  
  # Colunas Quantitativas Simples
  "QT_TEC_TOTAL" = microdados_ies$QT_TEC_TOTAL,
  "QT_TEC_FUND_INCOMP_FEM" = microdados_ies$QT_TEC_FUNDAMENTAL_INCOMP_FEM,
  "QT_TEC_FUND_INCOMP_MASC" = microdados_ies$QT_TEC_FUNDAMENTAL_INCOMP_MASC,
  "QT_TEC_FUND_COMP_FEM" = microdados_ies$QT_TEC_FUNDAMENTAL_COMP_FEM,
  "QT_TEC_FUND_COMP_MASC" = microdados_ies$QT_TEC_FUNDAMENTAL_COMP_MASC,
  "QT_TEC_MEDIO_FEM" = microdados_ies$QT_TEC_MEDIO_FEM,
  "QT_TEC_MEDIO_MASC" = microdados_ies$QT_TEC_MEDIO_MASC,
  "QT_TEC_SUPERIOR_FEM" = microdados_ies$QT_TEC_SUPERIOR_FEM,
  "QT_TEC_SUPERIOR_MASC" = microdados_ies$QT_TEC_SUPERIOR_MASC,
  "QT_TEC_ESPECIALIZACAO_FEM" = microdados_ies$QT_TEC_ESPECIALIZACAO_FEM,
  "QT_TEC_ESPECIALIZACAO_MASC" = microdados_ies$QT_TEC_ESPECIALIZACAO_MASC,
  "QT_TEC_MESTRADO_FEM" = microdados_ies$QT_TEC_MESTRADO_FEM,
  "QT_TEC_MESTRADO_MASC" = microdados_ies$QT_TEC_MESTRADO_MASC,
  "QT_TEC_DOUTORADO_FEM" = microdados_ies$QT_TEC_DOUTORADO_FEM,
  "QT_TEC_DOUTORADO_MASC" = microdados_ies$QT_TEC_DOUTORADO_MASC,
  "QT_DOC_TOTAL" = microdados_ies$QT_DOC_TOTAL,
  "QT_DOC_EXE" = microdados_ies$QT_DOC_EXE,
  "QT_DOC_EX_FEM" = microdados_ies$QT_DOC_EX_FEMI, 
  "QT_DOC_EX_MASC" = microdados_ies$QT_DOC_EX_MASC,
  "QT_DOC_EX_SEM_GRAD" = microdados_ies$QT_DOC_EX_SEM_GRAD,
  "QT_DOC_EX_GRAD" = microdados_ies$QT_DOC_EX_GRAD,
  "QT_DOC_EX_ESPEC" = microdados_ies$QT_DOC_EX_ESP, 
  "QT_DOC_EX_MESTRE" = microdados_ies$QT_DOC_EX_MEST,
  "QT_DOC_EX_DOUTOR" = microdados_ies$QT_DOC_EX_DOUT,
  "QT_DOC_EX_0_29" = microdados_ies$QT_DOC_EX_0_29,
  "QT_DOC_EX_30_34" = microdados_ies$QT_DOC_EX_30_34,
  "QT_DOC_EX_35_39" = microdados_ies$QT_DOC_EX_35_39,
  "QT_DOC_EX_40_44" = microdados_ies$QT_DOC_EX_40_44,
  "QT_DOC_EX_45_49" = microdados_ies$QT_DOC_EX_45_49,
  "QT_DOC_EX_50_54" = microdados_ies$QT_DOC_EX_50_54,
  "QT_DOC_EX_55_59" = microdados_ies$QT_DOC_EX_55_59,
  "QT_DOC_EX_60_MAIS" = microdados_ies$QT_DOC_EX_60_MAIS,
  "QT_DOC_EX_BRANCA" = microdados_ies$QT_DOC_EX_BRANCA,
  "QT_DOC_EX_PRETA" = microdados_ies$QT_DOC_EX_PRETA,
  "QT_DOC_EX_PARDA" = microdados_ies$QT_DOC_EX_PARDA,
  "QT_DOC_EX_AMARELA" = microdados_ies$QT_DOC_EX_AMARELA,
  "QT_DOC_EX_INDIGENA" = microdados_ies$QT_DOC_EX_INDIGENA,
  "QT_DOC_EX_COR_ND" = microdados_ies$QT_DOC_EX_COR_ND
)
```

```{r paged.print=TRUE}
#dim(microdados_ies)
#dim(dados_ies)
head(dados_ies)
```
## 2.2. Formando uma base de dados com informações dos cursos para filtrar informações de interesse
```{r}
library(dplyr)
dados_cursos <- cadastro_cursos %>%
  transmute(
    # Mapeamentos simples usando case_when 
    REDE = case_when(
      TP_REDE == 1 ~ "Pública",
      TP_REDE == 2 ~ "Privada",
      TRUE ~ NA_character_ # Default para valores ausentes/não mapeados
    ),
    
    # Mapeamento para NOME_CURSO INST.
    `NOME_CURSO INST.` = case_when(
      TP_ORGANIZACAO_ACADEMICA == 1 ~ "Universidade",
      TP_ORGANIZACAO_ACADEMICA == 2 ~ "Centro Universitário",
      TP_ORGANIZACAO_ACADEMICA == 3 ~ "Faculdade",
      TP_ORGANIZACAO_ACADEMICA == 4 ~ "Instituto Federal",
      TP_ORGANIZACAO_ACADEMICA == 5 ~ "Centro Federal de Ed. Tecnológica",
      TRUE ~ NA_character_
    ),
    
    # Lógica condicional para ORG. ADM
    `ORG. ADM` = case_when(
      TP_CATEGORIA_ADMINISTRATIVA >= 4 ~ "Privada",
      TP_CATEGORIA_ADMINISTRATIVA == 1 ~ "Federal",
      TP_CATEGORIA_ADMINISTRATIVA == 2 ~ "Estadual",
      TP_CATEGORIA_ADMINISTRATIVA == 3 ~ "Municipal",
      TRUE ~ NA_character_
    ),
    
    # Mapeamento para TIPO
    TIPO = case_when(
      TP_GRAU_ACADEMICO == 1 ~ "Bacharelado",
      TP_GRAU_ACADEMICO == 2 ~ "Licenciatura",
      TP_GRAU_ACADEMICO == 3 ~ "Tecnólogo",
      TP_GRAU_ACADEMICO == 4 ~ "Bacharelado e Licenciatura",
      
      TRUE ~ "Não se aplica" 
    ),
    
    # Mapeamento para GRAT
    GRAT = case_when(
      IN_GRATUITO == 0 ~ "Particular",
      IN_GRATUITO == 1 ~ "Gratuíto",
      TRUE ~ NA_character_
    ),
    
    # Mapeamento para MODALIDADE
    MODALIDADE = case_when(
      TP_MODALIDADE_ENSINO == 1 ~ "Presencial",
      TP_MODALIDADE_ENSINO == 2 ~ "à distância",
      TRUE ~ NA_character_
    ),
    
    
    CO_IES = CO_IES,
    CO_CURSO = CO_CURSO,
    NOME_CURSO = NO_CURSO,
    QT_VAGAS = QT_VG_TOTAL,
    QT_INSC = QT_INSCRITO_TOTAL,
    QT_ING = QT_ING,
    QT_ING_FEM = QT_ING_FEM,
    QT_ING_MASC = QT_ING_MASC,
    QT_ING_ENEM = QT_ING_ENEM,
    `QT_ING_0-17` = `QT_ING_0_17`, 
    `QT_ING_18-24` = `QT_ING_18_24`,
    `QT_ING_25-29` = `QT_ING_25_29`,
    `QT_ING_30-34` = `QT_ING_30_34`,
    `QT_ING_35-39` = `QT_ING_35_39`,
    `QT_ING_40-49` = `QT_ING_40_49`,
    `QT_ING_50-59` = `QT_ING_50_59`,
    `QT_ING_60+` = `QT_ING_60_MAIS`,
    QT_ING_BRANCA = QT_ING_BRANCA,
    QT_ING_PRETA = QT_ING_PRETA,
    QT_ING_PARDA = QT_ING_PARDA,
    QT_ING_AMARELA = QT_ING_AMARELA,
    QT_ING_INDIGENA = QT_ING_INDIGENA,
    QT_ING_COR_ND = QT_ING_CORND,
    QT_MAT = QT_MAT,
    QT_MAT_FEM = QT_MAT_FEM,
    QT_MAT_MASC = QT_MAT_MASC,
    QT_CONC = QT_CONC,
    QT_CONC_FEM = QT_CONC_FEM,
    QT_CONC_MASC = QT_CONC_MASC
  )
```

```{r}
head(dados_cursos)
```

# 3. Analisando o panoram Geral das Instituições de ensino Supeior
```{r}
tabela_frequencia <- dados_ies %>%
  # 1. Agrupando os dados pela coluna 'REGIAO'
  group_by(REGIAO) %>%
  # 2. Contando o número de ocorrências de cada região (valores absolutos)
  summarise(
    Valores_absolutos = n(),
    .groups = 'drop' # Remove o agrupamento após a sumarização
  ) %>%
  # 3. Calculando o total de instituições (para normalizar)
  mutate(
    Total_Geral = sum(Valores_absolutos),
    # 4. Calculando o percentual e arredondando para 2 casas decimais
    `Percentual (%)` = round((Valores_absolutos / Total_Geral) * 100, 2)
  ) %>%
  # 5. Removendo a coluna auxiliar 'Total_Geral'
  select(-Total_Geral)
```


```{r}
# Exibindo o total de instituições 
total <- sum(tabela_frequencia$Valores_absolutos)
cat(paste("Total de instituições:", total, "\n\n"))
```

Temos um total de 2561 Instituições de Ensino Superior (IES) no Brasil, segundo os dados disponibilizados. Destas a grande maioria, cerca de 42, 01% estão localizadas na região Sudeste. a região Norte é o que tem menos insitutições superiores, apenas 7,65%. Observe que se somarmos o quantitativo das regiões Norte, Sul e Centro-Oeste não atingimos o total de instituições da região sudeste.  O que mostra a grande discrepância do número de instituições de nível superior nas regiões do Brasil, conforme evidencia o gráfico seguinte.


```{r}
library(knitr)
# Exibindo a tabela  com os valores absoltuos e percentuais
kable(
  tabela_frequencia,
  caption = "Tabela 1: Valores absolutos e percentuais de IES por região",
  format = "pipe" # ou "html", "latex", dependendo do seu output
)
```

```{r}
library(ggplot2)

# Definindo o vetor de cores
cores <- c('red', 'blue', 'green', 'purple', 'orange')

# Criando o gráfico de barras de contagem
ggplot(dados_ies, aes(x = REGIAO)) + 
  geom_bar(fill = cores) + 
  labs(
    title = 'Figura 1: Quantitativo de IES por Região',
    x = 'Região',
    y = 'Quantidade de Instituições'
  ) +
  theme_minimal()
```

Sudeste e Nordeste são as duas regiões do Brasil mais populosas de acordo com IBGE (IBGE, 2022), o que nos faz pensar, obviamente, que por conta disso tem maior quantidade de IES, tendo em vista a maior demanda populacional. Isso nos leva a indagar se em termos percentuais há uma discrepância ou similaridade na quantidade de instituições superiores em nosso território, conforme as necessidades de cada região em número de habitantes. Para responder a tal indagação iremos ver a relação entre quantidade de IES e a população.

Utilizamos a projeção do senso feita em 2022 para o ano de 2023 para alinhar com os dados das IES. Fizemos a razão quantidade de instituições pelo número de habitantes de cada região e, como o valor é muito pequeno, colocamos na relação para cada 100 mil habitantes, conforme exibe a Tabela 2.

## 3.1.  Quantidade de instituições x populacão
```{r}
#Realizar a junção (merge) e manipulação
library(dplyr) 
pop_ies <- tabela_frequencia %>%
  left_join(POP_UF, by = "REGIAO") %>%
  select(-CO_REGIAO_IES) %>%
  rename(
    `Val._abs._IES` = Valores_absolutos, 
    `Percentual_ies (%)` = `Percentual (%)`
  )
```
```{r}
#Cálculo de densidade por região
pop_ies <- tabela_frequencia %>%
  left_join(POP_UF, by = "REGIAO") %>%
  select(-CO_REGIAO_IES) %>%
  rename(
    `Val._abs._IES` = Valores_absolutos, 
    `Percentual_ies (%)` = `Percentual (%)`
  ) %>%
  mutate(
    # Calcula IES por 100.000 habitantes
    IES_por_100k = round((`Val._abs._IES` / POPULAÇÃO) * 100000, 2)
  )

pop_ies
```
```{r}
library(knitr)
kable(
  pop_ies,
  caption = "Tabela 2: Quantidade de  IES por 100k habitantes",
  format = "pipe" 
)
```

Observamos que a região Centro-Oeste, apesar de ser a segunda menor em número de IES, em termos proporcionais a população, é a que apresentar maior número proporcional de IES. O que vai de encontro aos valores absolutos. A região Sudeste que tem o maior percentual de IES,em termos proporcionais tem menos IES do que a própria região Sul. Neste sentido, a distribuição de IES no território nacional não privelegia Regiões mais populosas, conseguindo equilibrar a demandanda regional.

###3.1.1  IES por Unidades Federativas (UFs)

Abaixo exibimos o quantitativo absoluto e relativo das IES por Unidade Federativa
```{r}
library(dplyr)

tabela_est <- dados_ies %>%
  # Agrupa os dados pela coluna 'UF'
  group_by(UF) %>%
  # Conta as ocorrências (Valores absolutos)
  summarise(
    `Val._absolutos` = n(),
    .groups = 'drop' # Remove o agrupamento
  ) %>%
  # Calcula o total geral para normalização
  mutate(
    Total_Geral = sum(`Val._absolutos`),
    # Calcula o percentual e arredonda para 2 casas decimais
    Percentual = round((`Val._absolutos` / Total_Geral) * 100, 2)
  ) %>%
  # Remove a coluna auxiliar e seleciona a ordem final
  select(-Total_Geral)

# Exibe a tabela
tabela_est
```

```{r}
library(dplyr)

# Ordena a tabela pela coluna 'Val._absolutos' de forma crescente
tabela_est_ord <- tabela_est %>%
  arrange(`Val._absolutos`)

tabela_est_ord
```

Quando analisamos o quantitativo de instituições por estado, temos um panorama não muito diferente (Figura 2). No entanto, com exceção de São Paulo e Minas Gerais, que são os estados mais populosos do Brasil (IBGE, 2022) e que possui o maior número de IES, o estado do Rio de Janeiro, por exemplo, que é o terceiro mais populoso, tem menos IES do que Paraná e Bahia. Na outra ponta, os estados menos populosos também segue com o menor número de IES, como Roraima, Amapá e Acre. 

```{r}

library(ggplot2)
library(dplyr)
library(forcats) 



ggplot(tabela_est, aes(x = fct_reorder(UF, `Val._absolutos`), y = `Val._absolutos`)) +
  geom_bar(stat = "identity", aes(fill = UF)) + # O ggplot2 gera 27 cores
  labs(
    title = 'Figra 2: Distribuição de Instituições por UF',
    x = 'UF',
    y = 'Quantidade de Instituições (Valores Absolutos)'
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```

Para deixar mais ilustrativo a diferença grande do número de IES entre os estados, plotamos o “gráfico de Pareto” da Figura 3. O gráfico mostra a distribuição de instituições por UF, com os valores absolutos em ordem decrescente. A barra azul representa a quantidade de instituições em cada UF. A linha vermelha acompanha os valores absolutos, mostrando a tendência da distribuição.
```{r}
library(dplyr)
library(ggplot2)
library(forcats) 

# 1. Ordenar o data frame por 'Val._absolutos' de forma decrescente
tabela_est_ord <- tabela_est %>%
  arrange(desc(`Val._absolutos`))

# 2. Criar o gráfico
ggplot(tabela_est_ord, aes(x = fct_reorder(UF, `Val._absolutos`, .desc = TRUE))) +
  
  # Gráfico de barras (Valores Absolutos)
  geom_bar(aes(y = `Val._absolutos`), stat = "identity", fill = 'blue') +
  
  # Gráfico de linha (Valores Absolutos)
  geom_line(aes(y = `Val._absolutos`, group = 1), color = 'red', linewidth = 1) +
  geom_point(aes(y = `Val._absolutos`), color = 'red', size = 3) +
  
  labs(
    title = 'Figura 3: Distribuição de Instituições por UF((Gráfico de Pareto)',
    x = 'UF',
    y = 'Quantidade de Instituições (Valores Absolutos)'
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1) # Rotação do eixo X
  )
```

Os primeiros UFs têm uma grande quantidade de instituições, indicando uma concentração de instituições nesses estados. Observe um declínio mais acentuado entre os três primeiros estados. Dai o declínio é mais gradual. Neste sentido, o gráfico de Pareto evidencia uma concentração das IES em poucos estados, como São Paulo e Minas Gerais. Os estados com maior número de IES estão no topo, enquanto os estados menos populosos, como Roraima e Amapá, possuem menor quantidade.

## 3.2. Instituições Públicas x Instituições Privadas
Nesta seção iremos fazer um panorama entre Instituições públicas e privadas. Consoante a Tabela 3 o quantitativo de instituições privadas é muito superior ao quantitativo de instituições públicas (87,6% das IES no Brasil são privadas e 12,4% são públicas). Apesar da discrepância gigantesca entre o número de IES públicas e privadas em todo o país, se analisarmos por regição, há um equilíbrio na distribuição de IES privadas e, com exceção da região Sul e Centro-Oeste também há um certo equilíbrio na distribuição de IES públicas nas regiões. 

```{r}
library(dplyr)
library(tidyr) 

# 1. Cria a contagem dos valores absolutos e o total por REGIÃO
regiao_REDE_inst <- dados_ies %>%
  group_by(REGIAO, REDE) %>%
  summarise(N = n(), .groups = 'drop') %>%
  
  # Transforma o formato longo (linhas) em formato largo (colunas)
  pivot_wider(names_from = REDE, values_from = N, values_fill = 0) %>%
  
  # 2. Adiciona a linha de 'Total' por região
  mutate(
    Total = Pública + Privada
  ) %>%
  
  # 3. Calcula os percentuais (substituindo o crosstab do Pandas)
  mutate(
    `%Pública` = round((Pública / Total) * 100, 1),
    `%Privada` = round((Privada / Total) * 100, 1)
  )

# 4. Adiciona a linha de TOTAL GERAL (similar ao margins=True)
# Calcula os totais de cada coluna (Pública, Privada, Total)
total_geral <- regiao_REDE_inst %>%
  summarise(
    REGIAO = "Total",
    Pública = sum(Pública),
    Privada = sum(Privada),
    Total = sum(Total),
    `%Pública` = round((Pública / Total) * 100, 1),
    `%Privada` = round((Privada / Total) * 100, 1)
  )

# 5. Combina a tabela de regiões com a linha de Total Geral
regiao_REDE_inst <- bind_rows(regiao_REDE_inst, total_geral)

# 6. Renomeia a tabela final para o nome 
regiao_NOME_CURSO_inst <- regiao_REDE_inst

regiao_NOME_CURSO_inst

library(knitr)
kable(
  regiao_NOME_CURSO_inst,
  caption = "Tabela 3: Quantidade de  IES Pública X Privada por região",
  format = "pipe" 
)
```
A maior diferença entre o número de IES públicas e privadas está na região Sul (8,7% contra 91,3%). O Centro-oeste também tem uma diferença gritante (9,1% contra 90,9%). O Gráfico da Figura 4. exibe os valores absolutos por região, em que fica evidente que as regiões Sudeste e Nordeste o quantitativo de IES públicas e privadas são muito maiores que as demais. Mas como já mostramos na seção anterior, em termos proporcionais às suas populações há um equilíbrio de distribuição das IES.

```{r}
library(dplyr)
library(ggplot2)


# 2. Criação do Gráfico de Barras Empilhadas
ggplot(dados_ies, aes(x = REGIAO, fill = REDE)) +
  
  geom_bar(position = "stack") + 
  
  labs(
    title = 'Figura 4: Distribuição de Instituições por Região e Tipo de IES (Pública x Privada)',
    x = 'Região',
    y = 'Quantidade de Instituições'
  ) +
  scale_fill_discrete(name = "IES Pública ou privada") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

## 3.3. Em relação aos Curso

### 3.3.1. Montagem do banco de dados que será utilizado nessas análises:
```{r}
quant_cursos <- data.frame(
  "Curso" = cadastro_cursos$NO_CINE_ROTULO,
  "Tipo_de_curso"= case_when(
      cadastro_cursos$TP_GRAU_ACADEMICO == 1 ~ "Bacharelado",
      cadastro_cursos$TP_GRAU_ACADEMICO == 2 ~ "Licenciatura",
      cadastro_cursos$TP_GRAU_ACADEMICO == 3 ~ "Tecnólogo",
            cadastro_cursos$TP_GRAU_ACADEMICO == 4 ~ "Bacharelado e Licenciatura",
      TRUE ~ "Não se aplica" 
    ),
  "Quantidade_de_vagas"= cadastro_cursos$QT_VG_TOTAL,
  "Numero_de_ingressantes"=cadastro_cursos$QT_ING,
  "Numero_de_concluintes"=cadastro_cursos$QT_CONC
  )
```

### 3.3.2. Cursos mais ofertados

Vamos analisar quais são os 10 cursos que são oferecidos em maior quantidade, para isso fazemos um código que contabiliza quantas vezes cada curso é oferecido, organiza os cursos em ordem decrescente de quantidade e separa os 10 mais oferecidos.

Em um panorama dos cursos superiores das IES, o curso mais presente é o de Pedagogia (21063 cursos), cerca de 2,92%, seguido de sistema de informação (2,82%) e adiministração (2,67%). A Tabela 4 exibe os 10 cursos em maior quantidade, com destaque para Sistemas de informação	na segunda posição. Outros curso não tão populares figuram também na lista, tais como Gestão Comercial e Gestão de Negócios.
Gestão Financeira e Logística.

```{r}
cursos_frequentes <- quant_cursos %>%
  group_by(Curso) %>%
summarise(
  Quantidade_de_cursos = n(),.groups = 'drop') %>%
  mutate(Total_Geral = sum(Quantidade_de_cursos),`Percentual (%)` = round((Quantidade_de_cursos / Total_Geral) * 100, 2)
  ) %>%
  select(-Total_Geral)

ord_cursos <- cursos_frequentes %>%
  arrange(desc(Quantidade_de_cursos))%>%
slice_head(n = 10)

library(knitr)
kable(
  ord_cursos,
  caption = "Tabela 4: Tabela de Cursos mais frequentes",
  format = "pipe" 
)

```

É possivel perceber que 7 dos 10 cursos mais oferecidos tem relação com a área empresarial.

### 3.3.3. Tipos de cursos mais ofertados

Ao análisarmos os tipos de graduação, o tecnólogo é consideravelmente mais oferecido do que os outros tipos, chegando a ser quase que metade dos cursos (47%), conforme Tabela 5. Uma maior quantidade de cursos da área empresarial e de cursos tecnólogos podem refletir uma demanda para uma formação mais rápida e direcionada para o ingresso no mercado de trabalho.

```{r}
library(dplyr)

tipo_curso <- cadastro_cursos %>%
  group_by(Tipo_de_curso) %>%
  summarise(
    Quant_grau = n(),
    .groups = "drop"
  ) %>%
  mutate(
    Total = sum(Quant_grau),
    Percentual = round((Quant_grau / Total) * 100, 2)
  ) %>%
  select(Tipo_de_curso, Quant_grau, Percentual)

ord_tipo <- tipo_curso %>%
  arrange(desc(Percentual))

library(knitr)

kable(
  ord_tipo,
  caption = "Tabela 5: Quantitativo e percentua de Cursos por tipo",
  format = "pipe"
)


```

Destaca-se que apenas 18,95% são cursos de Licenciatura. Isso pode se refletir pela baixa procura dos cursos de licenciatura devido à desvalorização da profissão docente. Alinhado a isso, temos o baixo número de vagas preenchidas e conclusões deste tipo de curso (Tabela 6)

```{r}
library(dplyr)

# Função para encontrar coluna por padrões prováveis
achar_col <- function(df, pads) {
  cols <- names(df)
  encontrados <- grep(paste(pads, collapse = "|"), cols, ignore.case = TRUE, value = TRUE)
  if (length(encontrados) == 0) {
    return(NA_character_)
  } else {
    return(encontrados[1])  # escolhe o primeiro candidato
  }
}

# identificar colunas no dataset
col_vagas      <- achar_col(dados_cursos, c("^QT_VAGAS?$", "QT_VG", "VAGA"))
col_ingressos  <- achar_col(dados_cursos, c("^QT_ING$", "QT_INGRE", "ING"))
col_concl       <- achar_col(dados_cursos, c("^QT_CONC$", "QT_CONCLU", "CONC"))

cat("Coluna vagas detectada: ", col_vagas, "\n")
cat("Coluna ingressos detectada: ", col_ingressos, "\n")
cat("Coluna concluintes detectada: ", col_concl, "\n")

# Checagem: aborta se alguma não for encontrada
if (any(is.na(c(col_vagas, col_ingressos, col_concl)))) {
  stop("Não foi possível localizar automaticamente as colunas de vagas/ingressantes/concluintes.\nVerifique names(dados_cursos) e passe os nomes corretos.")
}

# Assegurar que a coluna de agrupamento existe 
if (!"TIPO" %in% names(dados_cursos)) {
  stop("Coluna 'Tipo_de_curso' não encontrada em dados_cursos. Use o nome correto (diferencia maiúsc/minúsc).")
}

# Agregação usando nomes detectados
vagasA <- dados_cursos %>%
  group_by(TIPO) %>%
  summarise(
    vagas_total  = sum(.data[[col_vagas]], na.rm = TRUE),
    ingressantes = sum(.data[[col_ingressos]], na.rm = TRUE),
    concluintes  = sum(.data[[col_concl]], na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    `%_vagas_preenchidas` = if_else(vagas_total > 0,
                                    round((ingressantes / vagas_total) * 100, 2),
                                    NA_real_),
    `%_de_concluintes` = if_else(ingressantes > 0,
                                round((concluintes / ingressantes) * 100, 2),
                                NA_real_)
  ) %>%
  arrange(desc(`%_vagas_preenchidas`))

print(vagasA)


```

## 3.4. Análise descritiva de vagas ofertadas, matrículas e preenchidas

A Tabela 7 exibe a quantidade de matrículas de vagas ofertadas nas IES por região, assim como a taxa de preenchimento, ilustrado também no gráfico da Figura 5a. Observa-se que a região Sudeste oferta mais vagas, tem mais ingressantes e concluintes, por consequência. A região centro-oeste é a que mais fica a desejar neste aspecto.
```{r}
library(dplyr)
library(knitr)

dados_regiao <- dados_cursos %>% 
  filter(!is.na(NO_REGIAO), NO_REGIAO != "") %>% 
  group_by(NO_REGIAO) %>% 
  summarise(
    total_ing   = sum(QT_ING,      na.rm = TRUE),
    total_vagas = sum(QT_VG_TOTAL, na.rm = TRUE),
    total_conc  = sum(QT_CONC,     na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    perc_ing   = round(total_ing   / sum(total_ing)   * 100, 2),
    perc_vagas = round(total_vagas / sum(total_vagas) * 100, 2),
    perc_conc  = round(total_conc  / sum(total_conc)  * 100, 2)
  ) %>%
  arrange(desc(total_vagas))

kable(
  dados_regiao,
  caption = "Tabela 7: Distribuição de ingressantes, vagas ofertadas e concluintes por região",
  format = "pipe"
)

```

Outro dado importante de se analisar é o tipo de instituição que está oferecendo os cursos, se é publica ou privada (Tabela 8).

```{r}
library(dplyr)
library(knitr)
library(kableExtra)

# Tabela com ingressantes e concluintes por tipo de instituição
ing_conc_inst <- dadosB %>%
  filter(!is.na(tipo_de_inst), tipo_de_inst != "") %>%
  group_by(tipo_de_inst) %>%
  summarise(
    total_ingressantes = sum(qnt_ingressantes, na.rm = TRUE),
    total_concluintes  = sum(nmr_concluintes,   na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    total_geral_ing = sum(total_ingressantes),
    total_geral_conc = sum(total_concluintes),
    perc_ingressantes = round(total_ingressantes / total_geral_ing * 100, 2),
    perc_concluintes  = round(total_concluintes  / total_geral_conc * 100, 2),
    taxa_conclusao_pct = if_else(total_ingressantes > 0,
                                 round(total_concluintes / total_ingressantes * 100, 2),
                                 NA_real_)
  ) %>%
  select(tipo_de_inst,
         total_ingressantes, perc_ingressantes,
         total_concluintes,  perc_concluintes,
         taxa_conclusao_pct) %>%
  arrange(desc(total_ingressantes))

# Impressão formatada
kable(
  ing_conc_inst,
  caption = "Tabela 8: Ingressantes e Concluintes por tipo de instituição",
  format = "html",
  align = c("l", "r", "r", "r", "r", "r")
) %>%
  kable_classic(full_width = TRUE, html_font = "Arial") %>%
  column_spec(1, width = "6cm") %>%
  column_spec(2, width = "3.5cm") %>%
  column_spec(3, width = "3.5cm") %>%
  column_spec(4, width = ".53cm") %>%
  column_spec(5, width = "3.5cm") %>%
  column_spec(6, width = "3.5cm")
```

Como podemos observar há muito mais ofertas e portanto, muito mais ongressantes em instituições privada (88,52%) do que em instituições públicas, assim como concluientes. No entato, a taxa de conclusão, ou seja, a razão entre ingressantes e concluintes é muito maior em instituções públicas. Em outras palavras os alunos que ingressam em IES publicam concluem mais, o que indica que a evasão ou abandono em IES privadas é maior.

## 3.5. Perfil dos Funcionários das IES

Nesta seção iremos análise do Perfil dos servidores (técnicos):                      
- Quantidade total de servidores;             
- Distribuição de gênero entre os servidores;       
- Níveis de escolaridade entre os servidores.
### 3.5.1. Sexo e Escolaridade

Do total de 350.752  funcionários técnicos, 194.439 são do sexo feminino (55,4%) e 156.313 do sexo masculino (44,6%), portanto existe um número significativo a mais de mulheres que de homens, conforme ilustra a Figura 5 abaixo.

Ainda na Figura 7 (á direita) ilustramos graficamente a escolaridade dos técnicos, entre mulheres e homens.

```{r}
# --- seu gráfico ---
ggplot(dados_plot, aes(x = "", y = porcentagem, fill = genero)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  geom_text(aes(label = paste0(round(porcentagem, 1), "%")),
            position = position_stack(vjust = 0.5),
            color = "black", size = 5, fontface = "bold") +
  labs(title = "Figura 5: Percentuais de gênero entre os servidores técnicos das IES",
       fill = "Gênero") +
  theme_void()

# --- impressão logo após o gráfico ---
cat("\nResumo dos servidores técnicos:\n")
cat("Feminino :", format(total_feminino,  big.mark = ".", decimal.mark = ","), "\n")
cat("Masculino:", format(total_masculino, big.mark = ".", decimal.mark = ","), "\n")
cat("Total    :", format(total_servidores, big.mark = ".", decimal.mark = ","), "\n")

```

Analisando o nível de escolaridade de maneira geral entre os técicos educacionais, a maioria dos técnicos tem Ensino médio (26,32%). O
quantitativo dos que não tem nível médio (fundamental incompleto e fundamental completo) são maiores que o número de doutores (Tabela 9). Mas os maiores percentuais são dos que possuem ensino médio, superior e especialização. Este dado pode refletir o fato de que os concursos para tais cargos em geral exigem Ensino Superior, mas também é um dado importante para promoção de políticas públicas educacionais que incentivem a formação dos técnicos em programas de mestrado e doutorado. Como não há previsão de substitutos para cargos técnicos em processo de formação de mestrados e doutorados, isso dificulta a elevação de tais formações entre os técnicos.

```{r}
library(dplyr)
library(knitr)
library(kableExtra)

# Tabela agregada por nível geral de escolaridade
porcentagem_escolaridade_geral <- dados_escolaridade %>%
  group_by(escolaridade) %>%
  summarise(
    Total = sum(quantidade, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    Porcentagem = round((Total / sum(Total)) * 100, 2)
  )


# Impressão elegante com kable + kableExtra
porcentagem_escolaridade_geral %>%
  kable(
    format = "html",
    caption = "<div style='text-align: center; font-size: 18px; font-weight: bold;'>Tabela 9: DISTRIBUIÇÃO GERAL POR NÍVEL DE ESCOLARIDADE</div>",
    col.names = c("Escolaridade", "Total", "Porcentagem (%)"),
    align = c("c", "c", "c")
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    position = "center",
    font_size = 14
  ) %>%
  column_spec(1:3, width = "6cm") %>%
  row_spec(0, bold = TRUE, font_size = 16)

```

Na Figura 6, percebemos que, em geral, o nível de escolaridade das mulheres, em relação ao total delas, é maior que dos homens. Quanto maior a qualificação, maior é a "vantagem" das mulheres servidores em relação aos homens. Isso significa que as mulheres procuram se qualificar mais nas funções de nível técnico dentro das IES.


```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)


col_esperadas <- c(
  "QT_TEC_FUNDAMENTAL_INCOMP_FEM", "QT_TEC_FUNDAMENTAL_INCOMP_MASC",
  "QT_TEC_FUNDAMENTAL_COMP_FEM",   "QT_TEC_FUNDAMENTAL_COMP_MASC",
  "QT_TEC_MEDIO_FEM",             "QT_TEC_MEDIO_MASC",
  "QT_TEC_SUPERIOR_FEM",          "QT_TEC_SUPERIOR_MASC",
  "QT_TEC_ESPECIALIZACAO_FEM",    "QT_TEC_ESPECIALIZACAO_MASC",
  "QT_TEC_MESTRADO_FEM",          "QT_TEC_MESTRADO_MASC",
  "QT_TEC_DOUTORADO_FEM",         "QT_TEC_DOUTORADO_MASC"
)

faltantes <- setdiff(col_esperadas, names(tecnicos))
if (length(faltantes) > 0) {
  stop("Faltam colunas em 'tecnicos':\n", paste(faltantes, collapse = ", "))
}

# --- Agrupando e pivotendo ---
dados_escolaridade <- tecnicos %>%
  summarise(
    Fund_Incomp_FEM      = sum(QT_TEC_FUNDAMENTAL_INCOMP_FEM, na.rm = TRUE),
    Fund_Incomp_MASC     = sum(QT_TEC_FUNDAMENTAL_INCOMP_MASC, na.rm = TRUE),
    Fund_Comp_FEM        = sum(QT_TEC_FUNDAMENTAL_COMP_FEM, na.rm = TRUE),
    Fund_Comp_MASC       = sum(QT_TEC_FUNDAMENTAL_COMP_MASC, na.rm = TRUE),
    Medio_FEM            = sum(QT_TEC_MEDIO_FEM, na.rm = TRUE),
    Medio_MASC           = sum(QT_TEC_MEDIO_MASC, na.rm = TRUE),
    Superior_FEM         = sum(QT_TEC_SUPERIOR_FEM, na.rm = TRUE),
    Superior_MASC        = sum(QT_TEC_SUPERIOR_MASC, na.rm = TRUE),
    Especializacao_FEM   = sum(QT_TEC_ESPECIALIZACAO_FEM, na.rm = TRUE),
    Especializacao_MASC  = sum(QT_TEC_ESPECIALIZACAO_MASC, na.rm = TRUE),
    Mestrado_FEM         = sum(QT_TEC_MESTRADO_FEM, na.rm = TRUE),
    Mestrado_MASC        = sum(QT_TEC_MESTRADO_MASC, na.rm = TRUE),
    Doutorado_FEM        = sum(QT_TEC_DOUTORADO_FEM, na.rm = TRUE),
    Doutorado_MASC       = sum(QT_TEC_DOUTORADO_MASC, na.rm = TRUE)
  ) %>%
  pivot_longer(
    everything(),
    names_to = "categoria",
    values_to = "quantidade"
  ) %>%
  mutate(
    genero = ifelse(grepl("_FEM$", categoria), "Feminino", "Masculino"),
    escolaridade = gsub("_FEM$|_MASC$", "", categoria),
    escolaridade = case_when(
      escolaridade == "Fund_Incomp"  ~ "Fund. Incompleto",
      escolaridade == "Fund_Comp"    ~ "Fund. Completo",
      escolaridade == "Medio"        ~ "Médio",
      escolaridade == "Superior"     ~ "Superior",
      escolaridade == "Especializacao" ~ "Especialização",
      escolaridade == "Mestrado"     ~ "Mestrado",
      escolaridade == "Doutorado"    ~ "Doutorado",
      TRUE ~ escolaridade
    ),
    escolaridade = factor(escolaridade,
                          levels = c("Fund. Incompleto", "Fund. Completo", "Médio",
                                     "Superior", "Especialização", "Mestrado", "Doutorado"))
  ) %>%
  select(escolaridade, genero, quantidade)


dados_escolaridade <- dados_escolaridade %>%
  filter(!is.na(quantidade) & quantidade > 0)

print(dados_escolaridade)

# --- Gráfico de barras lado a lado  ---
ggplot(dados_escolaridade, aes(x = escolaridade, y = quantidade, fill = genero)) +
  geom_col(position = position_dodge(width = 0.9), alpha = 0.9, width = 0.8) +
  geom_text(aes(label = comma(quantidade)),
            position = position_dodge(width = 0.9),
            vjust = -0.25, size = 3.2) +
  labs(title = "Figura 6: Nível de escolaridade dos servidores técnicos por gênero",
       subtitle = "Distribuição completa por nível de escolaridade",
       x = "Nível de Escolaridade",
       y = "Quantidade de Técnicos",
       fill = "Gênero") +
  scale_fill_manual(values = c("Feminino" = "#FF6B6B", "Masculino" = "#4ECDC4")) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.12))) +
  theme_classic() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    axis.text.y = element_text(size = 11),
    legend.position = "right",
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 12, face = 'bold'),
    plot.title = element_text(size = 14, face = 'bold', hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    axis.title.x = element_text(face = "bold", size = 12, margin = margin(t = 8)),
    axis.title.y = element_text(face = "bold", size = 12, margin = margin(r = 8))
  )

```
A menor diferença está nos funcionários que tem doutorado. Nas IES, o número de homens que tem somente ensino fundamental completo ou incompleto é maior, nas demas qualificação a vantagem é sempre feminina, o que reforça nossa conclusão em relação à procura por qualificação se maior no sexo feminino.

### 3.5.2. Quantidade de técnicos por instituição pública e privada

Apesar do número de instituições privadas serem superiores ao número de instituições públicas (2244 x 317), a distribuição dos técnicos é bastante equilibrada (Figura 7), sendo 50,89% em ies públcias e 49,11% em IES privadas. Isto pode indicar que funcionários em IES privadas podem excecer diversas funções ou também retratar menos serviços oferecidos ou até mesmo reutilização de maão de obra.

```{r}
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(scales)

# Preparar dados: mapear tipo de rede e agregar
tec_inst_g <- dados %>%
  # garantir que existe a coluna e renomear para nomes claros
  transmute(
    tipo_de_rede = TP_REDE,
    total_de_tecnicos = QT_TEC_TOTAL
  ) %>%
  # mapear valores possíveis de TP_REDE (numérico ou string)
  mutate(
    tipo_de_rede = case_when(
      tipo_de_rede %in% c(1, "1") ~ "Pública",
      tipo_de_rede %in% c(2, "2") ~ "Privada",
      TRUE ~ "Outro"
    )
  ) %>%
  group_by(tipo_de_rede) %>%
  summarise(
    total_de_tecnicos = sum(as.numeric(total_de_tecnicos), na.rm = TRUE),
    .groups = "drop"
  ) %>%
  # remover categorias sem técnicos (opcional)
  filter(!is.na(total_de_tecnicos) & total_de_tecnicos > 0) %>%
  arrange(desc(total_de_tecnicos)) %>%
  mutate(
    porcentagem = round(total_de_tecnicos / sum(total_de_tecnicos) * 100, 2),
    # garantir a ordem no gráfico (maior -> menor)
    tipo_de_rede = factor(tipo_de_rede, levels = unique(tipo_de_rede))
  )

# Imprimir tabela com kable
tec_inst_g %>%
  kable(
    format = "html",
    caption = "<div style='text-align: center; font-size: 18px; font-weight: bold;'>DISTRIBUIÇÃO POR TIPO DE INSTITUIÇÃO</div>",
    col.names = c("Tipo de instituição", "Total de técnicos", "Porcentagem (%)"),
    align = c("l", "r", "r")
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE, position = "center", font_size = 14) %>%
  column_spec(1, width = "6cm") %>%
  column_spec(2:3, width = "3.5cm") %>%
  row_spec(0, bold = TRUE, font_size = 14)

# preparar paleta dinâmica (tanto cores quanto nomes)
n_cats <- nrow(tec_inst_g)
paleta_base <- c("#FF6B6B", "#4ECDC4", "#FFA600", "#7F7F7F")
cores_usadas <- rep_len(paleta_base, n_cats)
names(cores_usadas) <- levels(tec_inst_g$tipo_de_rede)

# limite y seguro (caso apenas um valor ou todos zeros tratados acima)
y_max <- ifelse(nrow(tec_inst_g) > 0, max(tec_inst_g$total_de_tecnicos, na.rm = TRUE) * 1.2, 1)

# Gráfico
ggplot(tec_inst_g, aes(x = tipo_de_rede, y = total_de_tecnicos, fill = tipo_de_rede)) +
  geom_col(width = 0.6, color = "white") +
  geom_text(aes(label = paste0(comma(total_de_tecnicos), "\n(", porcentagem, "%)")),
            vjust = -0.25, size = 4, fontface = "bold") +
  labs(title = "Figura 7: Distribuição dos técnicos por tipo de instituição",
       x = "Tipo de instituição",
       y = "Quantidade de Técnicos",
       fill = NULL) +
  scale_fill_manual(values = cores_usadas) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.06)), limits = c(0, y_max)) +
  theme_classic() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 11),
    legend.position = "none",
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5, margin = margin(t = 5, b = 10)),
    axis.title.x = element_text(face = "bold", size = 12, margin = margin(t = 8)),
    axis.title.y = element_text(face = "bold", size = 12, margin = margin(r = 8))
  )

```

## 3.6. Perfil dos docentes
### 3.6.1. Percentual da distribuição de gênero entre os docentes

Temos um total de 374.501 em exercícios nas IES brasileiras, incluindo públicas e privadas.

```{r}
library(dplyr)

# Separando as colunas dos docentes
docentes <- dados %>% select(starts_with('QT_DOC'), 'TP_REDE')

# Verificar se há dados faltantes
is.na(docentes) %>% sum()

# Totais
total_docentes       <- sum(docentes$QT_DOC_TOTAL, na.rm = TRUE)
total_em_exercicio   <- sum(docentes$QT_DOC_EXE,   na.rm = TRUE)

# Impressão com texto antes dos valores
cat("Total de docentes cadastrados:", 
    format(total_docentes, big.mark = ".", decimal.mark = ","), "\n")

cat("Total de docentes em exercício:", 
    format(total_em_exercicio, big.mark = ".", decimal.mark = ","), "\n")


```

Os dados da Figura 8, abaixo, revelam que entre os docentes há 195.617 homens (52,2%) e 178.884 mulheres (47,8%), totalizando 374.501 profissionais. Esta distribuição mostra uma ligeira predominância masculina de 4,4 pontos percentuais no corpo docente.

```{r}
total_docentes <- sum(docentes$QT_DOC_TOTAL)
print((total_docentes))


total_doc_feminino <- docentes %>% 
  select('QT_DOC_EX_FEMI') %>% 
  as.matrix() %>% 
  sum()

total_doc_masculino <- docentes %>% 
  select(ends_with('QT_DOC_EX_MASC')) %>% 
  as.matrix() %>% 
  sum()

# Criando dataframe para o gráfico de pizza
genero_docentes <- data.frame(
  genero = c("Feminino", "Masculino"),
  quantidade = c(total_doc_feminino, total_doc_masculino)
) %>%
  mutate(porcentagem = (quantidade / total_docentes) * 100)

print(genero_docentes)


# Gráficos porcentagem de docentes de acordo com o gênero

ggplot(genero_docentes, aes(x = "", y = porcentagem, fill = genero)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(round(porcentagem, 1), "%")), 
            position = position_stack(vjust = 0.5),
            color = "black", size = 6, fontface = "bold") +
  labs(title = "Figura 8: Percentual da distribuição de gênero entre os docentes",
       fill = " Gênero") +
  scale_fill_manual(values = c("#FF6B6B", "#4ECDC4")) +
  theme_void() +
  theme(legend.position = "right",
        legend.text = element_text(size = 12),
        legend.title = element_text(size = 14, face = 'bold'),
        plot.title = element_text(size = 16, face = 'bold', hjust = 0.2)
        )
```
### 3.6.2. Distribuição do nível de escolaridade entre os docentes

A Tabela 10 evidencia que, surpreendentemente, ainda temos um quantitativo (muito pequeno, mas temos) de professores sem graduação nas IES, mas a maioria são doutores, o que reflete a busca por qualificação dos docentes, mas também políticas de qualificação, alinhados a possibilidade de afastamento para estudo, assim como necessidades para atuar em níveis de ensino mais avançados como cursos de mestrado e doutorado. 

```{r, echo=TRUE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)


titulacao_df <- docentes %>%
  mutate(
    tipo_instituicao = case_when(
      TP_REDE == 1 ~ "Pública",
      TP_REDE == 2 ~ "Privada",
      TRUE ~ NA_character_
    )
  ) %>%
  select(tipo_instituicao,
         Sem_graduação  = QT_DOC_EX_SEM_GRAD,
         Graduação      = QT_DOC_EX_GRAD,
         Especialização = QT_DOC_EX_ESP,
         Mestrado       = QT_DOC_EX_MEST,
         Doutorado      = QT_DOC_EX_DOUT) %>%
  pivot_longer(
    cols = -tipo_instituicao,
    names_to = "titulacao",
    values_to = "quantidade"
  ) %>%
  group_by(titulacao) %>%
  summarise(
    Total_Geral      = sum(quantidade, na.rm = TRUE),
    Publica          = sum(quantidade[tipo_instituicao == "Pública"], na.rm = TRUE),
    Privada          = sum(quantidade[tipo_instituicao == "Privada"], na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    Perc_Total   = round(Total_Geral / sum(Total_Geral) * 100, 2),
    Perc_Publica = round(Publica      / Total_Geral * 100, 2),
    Perc_Privada = round(Privada      / Total_Geral * 100, 2)
  ) %>%
  
  select(
    titulacao,
    Total_Geral,
    Perc_Total,
    Publica,
    Perc_Publica,
    Privada,
    Perc_Privada
  )

# Tabela formatada
kable(
  titulacao_df,
  format = "html",
  caption = "<b>Tabela 10:  Distribuição da Titulação dos Docentes por Tipo de Instituição</b>",
  col.names = c(
    "Titulação",
    "Total Geral",
    "% Total",
    "IES Pública",
    "% Pública",
    "IES Privada",
    "% Privada"
  ),
  align = "c"
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover"),
    full_width = FALSE,
    position = "center",
    font_size = 13
  ) %>%
  row_spec(0, bold = TRUE, font_size = 14)


```

Obviamente que estes são apenas alguns dos muitos motivos da busca por maior de qualificação entre docentes. Esta busca, notadamente,
perpassa também pelo incentivo financeiro e de progressão dentro das IES, especialmente as públicas. A Figura 9 abaixo evidencia que 53% dos nossos docentes são doutores e 32% são mestres. Esta soma mostra a busca constante por qualificação e possivelmente incentivos pela mesma dentro da IES.

```{r}
# Gráfico 9: Total geral por escolaridade
library(ggplot2)
library(dplyr)
library(scales)

# Usa titulacao_df gerada acima
plot_df <- titulacao_df %>%
  # garantir que existe e ordenar por Total_Geral desc
  arrange(desc(Total_Geral)) %>%
  mutate(
    titulacao = factor(titulacao, levels = unique(titulacao)),
    label = paste0(comma(Total_Geral), "\n(", Perc_Total, "%)")
  )

# Gráfico
ggplot(plot_df, aes(x = titulacao, y = Total_Geral)) +
  geom_col(fill = "#4ECDC4", alpha = 0.8, width = 0.7) +
  geom_text(aes(label = label),
            vjust = -0.3,
            size = 4,
            fontface = "bold",
            lineheight = 0.8) +
  labs(
    title = "Figura 9: Total de docentes por nível de escolaridade",
    subtitle = "Valores absolutos e percentual do total entre parênteses",
    x = "Nível de Escolaridade",
    y = "Total de Docentes"
  ) +
  scale_y_continuous(labels = comma,
                     limits = c(0, max(plot_df$Total_Geral, na.rm = TRUE) * 1.15)) +
  theme_classic() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),
    legend.position = "none",
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 14, hjust = 0.5),
    axis.title.x = element_text(face = "bold", size = 14, margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", size = 14, margin = margin(r = 10))
  )

```

 Apesar disso, a maior quantidade de mestres e  doutores atua em instituições particulares (Figura 0). Vale salientar, que pode haver interseção, quando se trata de docentes sem dedicação exclusiva em IES públicas.
 
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)

# usa 'titulacao_df' gerada antes (colunas: titulacao, Total_Geral, Publica, Privada, Perc_...)
# preparar dados para comparação Pública x Privada
dados_comp <- titulacao_df %>%
  select(titulacao, Publica, Privada) %>%
  pivot_longer(cols = c(Publica, Privada), names_to = "Tipo", values_to = "Quantidade") %>%
  arrange(desc(Quantidade)) %>%
  # garantir ordem das categorias igual ao gráfico anterior (maior -> menor por Total_Geral)
  mutate(titulacao = factor(titulacao, levels = unique(titulacao)))

# limite y seguro
y_max <- if (nrow(dados_comp) > 0) max(dados_comp$Quantidade, na.rm = TRUE) * 1.12 else 1

# Gráfico adaptado
ggplot(dados_comp, aes(x = titulacao, y = Quantidade, fill = Tipo)) +
  geom_col(position = position_dodge(width = 0.9), width = 0.75, alpha = 0.85, color = "white") +
  geom_text(aes(label = comma(Quantidade)),
            position = position_dodge(width = 0.9),
            vjust = -0.3,
            size = 3.2,
            fontface = "bold") +
  labs(
    title = "Figura 10: Níveis de titulação entre docentes de IES públicas e privadas",
    x = "",
    y = "Quantidade de Docentes",
    fill = "Tipo de instituição"
  ) +
  scale_fill_manual(values = c("Publica" = "#1F77B4", "Privada" = "#FF7F0E"),
                    labels = c("Pública", "Privada")) +
  scale_y_continuous(labels = comma, limits = c(0, y_max)) +
  theme_classic() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11),
    axis.text.y = element_text(size = 11),
    legend.position = "right",
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 12, face = "bold"),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    axis.title.y = element_text(face = "bold", size = 12)
  )

```
 
### 3.6.3. Faixa etária dos docentes
```{r}
grep("regiao", names(cadastro_cursos), value = TRUE, ignore.case = TRUE)

```

